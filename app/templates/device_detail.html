{% extends 'base.html' %}

{% block content %}
<h2>Live Traffic for {{ device_ip }}</h2>
<ul id="traffic-log"></ul>
<script>
    const socket = io();

    socket.on('connect', () => {
        console.log('Connected to server');
    });

    socket.on('new_traffic', data => {
        if(data.src_ip === "{{ device_ip }}" || data.dst_ip === "{{ device_ip }}"){
            const log = document.getElementById('traffic-log');
            const item = document.createElement('li');
            const time = new Date(data.timestamp * 1000).toLocaleTimeString();
            item.textContent = `[${time}] Traffic from ${data.src_ip} to ${data.dst_ip}`;
            log.prepend(item);
        }
    });
</script>
{% endblock %}
